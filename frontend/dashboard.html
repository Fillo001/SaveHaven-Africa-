<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Dashboard — SafeHaven Africa</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <main class="container">
    <h1>SafeHaven Dashboard</h1>
    <div id="map" style="height:480px;border-radius:8px;"></div>
    <section class="card">
      <h2>Recent Reports</h2>
      <ul id="recentList"></ul>
    </section>
    <p><a href="index.html">Back home</a></p>
  </main>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="app.js"></script>
  <script>
    (async function init() {
      const reports = await fetchReports();
      const hotspots = await fetchHotspots();
      // init map
      const map = L.map('map').setView([9.082, 8.6753], 6);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
      reports.forEach(r => {
        L.marker([r.location.lat, r.location.lng]).addTo(map)
          .bindPopup(`<b>${r.category}</b><br>${r.description.slice(0,120)}...`);
        const li = document.createElement('li');
        li.innerHTML = `<b>${r.category}</b> — ${new Date(r.createdAt).toLocaleString()} <div>${r.description}</div>`;
        document.getElementById('recentList').appendChild(li);
      });
      hotspots.forEach(h => {
        L.circle([h.lat, h.lng], { radius: Math.min(h.count * 200, 5000), color: 'red', fillOpacity: 0.2 }).addTo(map)
          .bindTooltip(`Hotspot: ${h.count}`);
      });
    })();
  </script>
</body>
</html>
